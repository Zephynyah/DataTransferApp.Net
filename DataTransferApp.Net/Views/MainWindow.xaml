<Window x:Class="DataTransferApp.Net.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
        xmlns:local="clr-namespace:DataTransferApp.Net"
        xmlns:control="clr-namespace:DataTransferApp.Net.Controls"
        xmlns:helpers="clr-namespace:DataTransferApp.Net.Helpers"
        mc:Ignorable="d"
        Title="Data Transfer Application" 
        Height="1000" Width="1400"
        MinHeight="1000" MinWidth="1400"
        WindowStartupLocation="CenterScreen"
        Icon="/Assets/app.png"
        Background="{StaticResource BackgroundBrush}"
        Closing="Window_Closing">
    
    <Window.Resources>
        <!-- Converters -->
 
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource DarkBrush}" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Image Source="/Assets/app.png" Width="40" Height="40" Margin="0,0,10,0" VerticalAlignment="Center" Grid.Column="0"/>
                
                <StackPanel Grid.Column="1">
                    <TextBlock Text="{Binding AppTitle}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource BackgroundBrush}"/>
                    <TextBlock Text="{Binding AppDescription}" FontSize="12" Foreground="{StaticResource LightBrush}" FontWeight="SemiBold"/>
                </StackPanel>

                <!-- User Info -->
                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="0,0,15,0">
                    <TextBlock Text="{Binding CurrentUser}" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource BackgroundBrush}" HorizontalAlignment="Right"/>
                    <TextBlock Text="{Binding CurrentDateTime}" FontSize="12" Foreground="{StaticResource LightBrush}" HorizontalAlignment="Right"/>
                </StackPanel>

                <!-- Menu Button with Dropdown -->
                <Button Grid.Column="3" 
                        x:Name="MenuButton"
                        Background="Transparent" 
                        BorderBrush="Transparent" 
                        BorderThickness="1"
                        Width="40"
                        Height="40"
                        Cursor="Hand"
                        Padding="8"
                        VerticalAlignment="Center"
                        Click="MenuButton_Click">
                    <Button.Content>
                         <fa:IconBlock Icon="Navicon" Foreground="{StaticResource BackgroundBrush}" FontSize="18" Margin="0,0,5,0"/>
                    </Button.Content>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                BorderBrush="{TemplateBinding BorderBrush}" 
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource SecondaryBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Button.ContextMenu>
                        <ContextMenu x:Name="MenuDropdown" Placement="Bottom"  HorizontalOffset="-170" VerticalOffset="5" IsOpen="{Binding IsContextMenuOpen, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Button}}, Mode=TwoWay}">
                             <ContextMenu.ItemContainerStyle>
                                <Style TargetType="MenuItem">
                                    <!-- Padding: Left, Top, Right, Bottom.  Set Top/Bottom to control vertical space (Y) -->
                                    <Setter Property="Padding" Value="10, 5, 10, 5"/>
                                </Style>
                            </ContextMenu.ItemContainerStyle>
                            <MenuItem Header="Transfer History" Command="{Binding ViewTransferHistoryCommand}">
                                <MenuItem.Icon>
                                    <fa:IconBlock Icon="History" Foreground="{StaticResource SecondaryBrush}" FontSize="16"/> 
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Settings" Command="{Binding OpenSettingsCommand}">
                                <MenuItem.Icon>
                                    <fa:IconBlock Icon="Cog" Foreground="{StaticResource SecondaryBrush}" FontSize="16"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Help" Command="{Binding OpenHelpCommand}">
                                <MenuItem.Icon>
                                    <fa:IconBlock Icon="QuestionCircle" Foreground="{StaticResource SecondaryBrush}" FontSize="16"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="About" Command="{Binding OpenAboutCommand}">
                                <MenuItem.Icon>
                                    <fa:IconBlock Icon="InfoCircle" Foreground="{StaticResource SecondaryBrush}" FontSize="16"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="What's New" Command="{Binding OpenChangesCommand}">
                                <MenuItem.Icon>
                                    <fa:IconBlock Icon="Newspaper" Foreground="{StaticResource SecondaryBrush}" FontSize="16"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="Run Retention Cleanup" Command="{Binding RunRetentionCleanupAsyncCommand}" IsEnabled="{Binding IsRetentionCleanupRunning, Converter={StaticResource InverseBoolConverter}}">
                                <MenuItem.Icon>
                                    <fa:IconBlock Icon="Tasks" Foreground="{StaticResource SecondaryBrush}" FontSize="16"/>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>
                
                <!-- Exit Button (Only visible in fullscreen) -->
                <Button Grid.Column="4" 
                        Click="ExitButton_Click"
                        ToolTip="Exit Fullscreen Mode (F11)"
                        Background="Transparent" 
                        BorderBrush="#E74C3C" 
                        BorderThickness="1"
                        Width="38"
                        Height="38"
                        Cursor="Hand"
                        Padding="6"
                        Margin="10,0,0,0"
                        VerticalAlignment="Center"
                        x:Name="ExitButton">
                    <Button.Content>
                        <fa:IconBlock Icon="Times" Foreground="{StaticResource DangerBrush}" FontSize="18"/>
                    </Button.Content>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                BorderBrush="{TemplateBinding BorderBrush}" 
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ElementName=ExitButton, Path=Tag}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#E74C3C"/>
                                    <Setter Property="BorderBrush" Value="#E74C3C"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Border>
        
        <!-- Statistics -->
        <Border Grid.Row="1" Background="White" BorderBrush="{StaticResource LightBrush}" BorderThickness="0,0,0,1" Padding="15,5,10,5" Margin="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock Text="Total: " Style="{StaticResource HeaderTextStyle}"/>
                    <TextBlock Text="{Binding TotalFolders}" Foreground="{StaticResource PrimaryBrush}" Style="{StaticResource StatValueStyle}" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock Text="Ready: " Style="{StaticResource HeaderTextStyle}"/>
                    <TextBlock Text="{Binding ReadyFolders}" Foreground="{StaticResource SuccessBrush}" Style="{StaticResource StatValueStyle}" />
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock Text="Caution: " Style="{StaticResource HeaderTextStyle}"/>
                    <TextBlock Text="{Binding CautionFolders}" Foreground="{StaticResource WarningBrush}" Style="{StaticResource StatValueStyle}" />
                </StackPanel>

                <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock Text="Failed: " Style="{StaticResource HeaderTextStyle}"/>
                    <TextBlock Text="{Binding FailedFolders}" Foreground="{StaticResource DangerBrush}" Style="{StaticResource StatValueStyle}" />
                </StackPanel>

                <StackPanel Grid.Column="4" Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock Text="Transferred: " Style="{StaticResource HeaderTextStyle}"/>
                    <TextBlock Text="{Binding TransferredCount}" Foreground="{StaticResource PrimaryBrush}" Style="{StaticResource StatValueStyle}" />
                </StackPanel>

                <StackPanel Grid.Column="5" Orientation="Horizontal" Margin="0,5,0,0"> 
                    <TextBlock Text="Size: " Style="{StaticResource HeaderTextStyle}"/>
                    <TextBlock Text="{Binding TotalSize}" Foreground="{StaticResource PrimaryBrush}" Style="{StaticResource StatValueStyle}" />
                </StackPanel>

                <Border Grid.Column="6" x:Name="Border" Background="White" BorderBrush="Gray" BorderThickness="1" Margin="0,0,0,0" Border.CornerRadius="3" Padding="0" Height="30" VerticalAlignment="Center">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <!-- 1. Left IconBlock -->
                        <fa:IconBlock Grid.Column="0" Icon="Hdd" Foreground="{StaticResource AnimationBlueBrush}" FontSize="14" VerticalAlignment="Center" Margin="5,0" >
                            <fa:IconBlock.ToolTip>
                                <ToolTip Background="Transparent" BorderThickness="0">
                                    <control:AwesomeToolTip Title="Select External Drive" Description="This selects the external drive for data transfer." />
                                </ToolTip>
                            </fa:IconBlock.ToolTip>
                        </fa:IconBlock>
                        <!-- 2. Center ComboBox -->
                        <ComboBox Grid.Column="1" ItemsSource="{Binding RemovableDrives}" SelectedItem="{Binding SelectedDrive}" DisplayMemberPath="DisplayText" Width="300" BorderThickness="1,0,1,0" />
                        <!-- 2. Right Buttons -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="5,0">
                            <Button Command="{Binding DetectDrivesCommand}" Style="{StaticResource ButtonStyle}" Margin="0" Padding="5,0,10,0" Background="Transparent" BorderBrush="Transparent">
                                <Button.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="Refresh List" Description="This refreshes the list of removable drives." />
                                    </ToolTip>
                                </Button.ToolTip>
                                <fa:IconBlock Icon="Refresh" Foreground="{StaticResource AnimationBlueBrush}" Margin="0" FontSize="14"/>
                            </Button>
                            <Button  Command="{Binding ClearDriveCommand}" Style="{StaticResource ButtonStyle}" Margin="0" Padding="5,0,5,0" Background="Transparent" BorderBrush="Transparent">
                                <Button.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="Clear Drive Contents" Description="This clears the contents of the selected external drive." />
                                    </ToolTip>
                                </Button.ToolTip>
                                <fa:IconBlock Icon="Trash" Foreground="{StaticResource DangerBrush}" Margin="0" FontSize="14" />
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        
        <!-- Main Content -->
        <Grid Grid.Row="2" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Left Panel -->
            <Border Grid.Column="0" Background="White" BorderBrush="{StaticResource LightBrush}" BorderThickness="1" Margin="0,0,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                     <Border Grid.Row="0" Background="{StaticResource LightBackgroundBrush}" Padding="10" BorderBrush="{StaticResource LightBrush}" BorderThickness="0,0,0,1" Height="40">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <fa:IconBlock Grid.Column="0" Icon="Dropbox" Foreground="{StaticResource SecondaryBrush}" FontSize="16" Margin="0,0,5,0"/>

                            <TextBlock Text="Dropbox Folders" FontWeight="Bold" FontSize="14" Grid.Column="1" Margin="0,0,10,0" Padding="0">
                                <TextBlock.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="User Folder list" Description="List of user folders for data transfer." />
                                    </ToolTip>
                                </TextBlock.ToolTip>
                            </TextBlock>

                            <Button
                                Background="Transparent" 
                                BorderBrush="Transparent" 
                                Padding="0,0,10,0" 
                                Margin="0"
                                Grid.Column="2"  
                                Click="OpenFolderButton_Click"
                                ToolTipService.InitialShowDelay="250" 
                                ToolTipService.BetweenShowDelay="0">
                                 <Button.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="Open Folder" Description="This opens the selected Dropbox folder." />
                                    </ToolTip>
                                </Button.ToolTip>
                                <fa:IconBlock Grid.Column="0" Icon="FolderOpen" Foreground="{StaticResource SecondaryBrush}" FontSize="16" Margin="0,0,5,0"/>
                            </Button>

                            <Button 
                                Background="Transparent" 
                                BorderBrush="Transparent" 
                                Padding="0" 
                                Margin="0" 
                                Grid.Column="3" 
                                Command="{Binding LoadDataCommand}" 
                                IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}" 
                                ToolTipService.InitialShowDelay="250" 
                                ToolTipService.BetweenShowDelay="0">
                                <Button.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="Refresh List" Description="This refreshes the list of Dropbox folders." />
                                    </ToolTip>
                                </Button.ToolTip>
                                <fa:IconBlock Icon="Refresh" Foreground="{StaticResource SecondaryBrush}" FontSize="16"/>
                            </Button>
                        </Grid>
                    </Border>
                    
                    <ListBox Grid.Row="1" 
                             ItemsSource="{Binding FolderList}" 
                             SelectedItem="{Binding SelectedFolder, Mode=TwoWay}"
                             BorderBrush="{StaticResource LightBrush}" 
                             BorderThickness="0,0,0,1"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{StaticResource LightBlueBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8,6" Margin="0">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Style.Triggers>
                                                <!-- Background color based on audit status -->
                                                <DataTrigger Binding="{Binding AuditStatus}" Value="Passed">
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <SolidColorBrush Color="#2ECC71" Opacity="0.15"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AuditStatus}" Value="Failed">
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <SolidColorBrush Color="#E74C3C" Opacity="0.15"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AuditStatus}" Value="Caution">
                                                    <Setter Property="Background">
                                                        <Setter.Value>
                                                            <SolidColorBrush Color="#F39C12" Opacity="0.35"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="4"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Status Indicator Bar -->
                                        <Border Grid.Column="0" 
                                                Background="{Binding AuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}"
                                                CornerRadius="2"
                                                Margin="0,0,8,0"/>
                                        
                                        <!-- Folder Info -->
                                        <StackPanel Grid.Column="1">
                                            <!-- Folder Name -->
                                            <TextBlock Text="{Binding FolderName}" TextWrapping="Wrap" FontWeight="SemiBold" FontSize="12"/>
                                            
                                            <!-- Stats: Size | File Count -->
                                            <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                                <TextBlock Text="{Binding SizeFormatted}" FontSize="10" Foreground="{StaticResource FootNoteDarkBrush}"/>
                                                <TextBlock Text=" | " FontSize="10" Foreground="#bdc3c7" Margin="3,0"/>
                                                <TextBlock FontSize="10" Foreground="{StaticResource FootNoteDarkBrush}">
                                                    <Run Text="{Binding FileCount, Mode=OneWay}"/>
                                                    <Run Text=" files"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Information Icon with Details (shown when audited and has issues) -->
                                        <Border Grid.Column="2" VerticalAlignment="Center" Margin="5,0,0,0">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <!-- Show icon when folder is audited and has violations AND setting is enabled -->
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding AuditStatus}" Value="Failed"/>
                                                                <Condition Binding="{Binding DataContext.ShowFolderAuditDetailsIcon, RelativeSource={RelativeSource AncestorType=Window}}" Value="True"/>
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </MultiDataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <fa:IconBlock Icon="InfoCircle" Foreground="#e74c3c" FontSize="14" ToolTipService.ShowDuration="10000">
                                                <fa:IconBlock.ToolTip>
                                                    <ToolTip MaxWidth="300">
                                                        <StackPanel>
                                                            <TextBlock Text="Audit Issues"   FontWeight="Bold"  FontSize="12" Margin="0,0,0,5"/>
                                                            
                                                            <!-- Naming Status -->
                                                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                                                <TextBlock Text="• Naming: " FontSize="11"/>
                                                                <TextBlock Text="{Binding NamingAuditStatus}" 
                                                                           FontSize="11"
                                                                           FontWeight="SemiBold"
                                                                           Foreground="{Binding NamingAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}"/>
                                                            </StackPanel>
                                                            
                                                            <!-- Blacklist Status -->
                                                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                                                <TextBlock Text="• Blacklist: " FontSize="11"/>
                                                                <TextBlock Text="{Binding BlacklistAuditStatus}" FontSize="11" FontWeight="SemiBold"
                                                                           Foreground="{Binding BlacklistAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}"/>
                                                                <TextBlock Text="{Binding BlacklistViolationCount, StringFormat=' ({0} violations)'}" 
                                                                           FontSize="11"
                                                                           Foreground="#e74c3c">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding BlacklistAuditStatus}" Value="Failed">
                                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                            </StackPanel>
                                                            
                                                            <!-- Compressed Status -->
                                                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                                                <TextBlock Text="• Compressed: " FontSize="11"/>
                                                                <TextBlock Text="{Binding CompressedAuditStatus}" FontSize="11" FontWeight="SemiBold"
                                                                           Foreground="{Binding CompressedAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}"/>
                                                                <TextBlock Text="{Binding CompressedFileCount, StringFormat=' ({0} files)'}" 
                                                                           FontSize="11"
                                                                           Foreground="{Binding CompressedAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding CompressedAuditStatus}" Value="Caution">
                                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding CompressedAuditStatus}" Value="Failed">
                                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                            </StackPanel>
                                                        </StackPanel>
                                                    </ToolTip>
                                                </fa:IconBlock.ToolTip>
                                            </fa:IconBlock>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <StackPanel Grid.Row="2" Margin="10,5">
                        <Button Style="{StaticResource ButtonStyle}"  Command="{Binding AuditAllFoldersCommand}" IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconBlock Icon="Search" Foreground="{StaticResource BackgroundBrush}" FontSize="14" Margin="0,0,5,0"/>
                                <TextBlock Text="Audit All" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <!-- Transfer All Button -->
                        <Button Style="{StaticResource SuccessButtonStyle}" Command="{Binding TransferAllFoldersCommand}">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconBlock Icon="Upload" Foreground="{StaticResource BackgroundBrush}" FontSize="14" Margin="0,0,5,0"/>
                                <TextBlock Text="Transfer All" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <!-- Cancel Transfer Button -->
                        <Button Style="{StaticResource DangerButtonStyle}" Command="{Binding CancelTransferCommand}">
                            <StackPanel Orientation="Horizontal">
                                <fa:IconBlock Icon="Stop" Foreground="{StaticResource BackgroundBrush}" FontSize="14" Margin="0,0,5,0"/>
                                <TextBlock Text="Cancel" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Right Panel -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Folder Details -->
                <Border Grid.Row="0" Background="White" BorderBrush="{StaticResource LightBrush}" BorderThickness="1" Padding="15,5" Margin="0,0,0,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="40"/>
                            <RowDefinition Height="30"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Row="0" Grid.Column="0" Visibility="{Binding SelectedFolder, Converter={StaticResource NullToVisibilityConverter}}">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{Binding SelectedFolder.FolderName, TargetNullValue='No folder selected'}" FontSize="16" FontWeight="SemiBold" Margin="0,0,20,0"/>
                                <!-- Stats: Size | File Count -->
                                <StackPanel Orientation="Horizontal" Margin="0,3,0,0" >
                                    <StackPanel.Resources>
                                        <!-- Implicit Style: Automatically applies to all TextBlocks in this StackPanel -->
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="FontSize" Value="12"/>
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                        </Style>
                                    </StackPanel.Resources>
                                    <TextBlock Text="{Binding SelectedFolder.AuditStatus, StringFormat='Status: {0}'}" Foreground="{Binding SelectedFolder.AuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}"/>
                                    <TextBlock Text=" | " Margin="3,0" />
                                    <TextBlock Text="{Binding SelectedFolder.SizeFormatted}" />
                                    <TextBlock Text=" | " Margin="3,0"/>
                                    <TextBlock>
                                        <Run Text="{Binding SelectedFolder.FileCount, Mode=OneWay}"/>
                                        <Run Text=" files"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Audit Summary with Color-Coded Status -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,0" Visibility="{Binding SelectedFolder, Converter={StaticResource NullToVisibilityConverter}}">

                            <!-- Card Style (Badges) -->
                            <StackPanel Orientation="Horizontal" Visibility="{Binding ShowAuditSummaryAsCards, Converter={StaticResource BooleanToVisibilityConverter}}">

                                <!-- Naming Audit Card -->
                                <Border Background="{Binding SelectedFolder.NamingAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" CornerRadius="3" Padding="8,4" Margin="0,5,10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <fa:IconBlock Icon="FolderOpen" Foreground="{StaticResource BackgroundBrush}" FontSize="14" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Folder Name: " Foreground="{StaticResource BackgroundBrush}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding SelectedFolder.NamingAuditStatus}" Foreground="{StaticResource BackgroundBrush}" FontWeight="Bold" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>

                                <!-- Blacklist Audit Card -->
                                <Border Background="{Binding SelectedFolder.BlacklistAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" CornerRadius="3" Padding="8,4" Margin="0,5,10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <fa:IconBlock Icon="Ban" Foreground="{StaticResource BackgroundBrush}" FontSize="14" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Blacklist: " Foreground="{StaticResource BackgroundBrush}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding SelectedFolder.BlacklistAuditStatus}" Foreground="{StaticResource BackgroundBrush}" FontWeight="Bold" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding SelectedFolder.BlacklistViolationCount, StringFormat=' ({0} violations)'}" Foreground="{StaticResource BackgroundBrush}" FontWeight="Bold" VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding SelectedFolder.BlacklistViolationCount}" Value="0">
                                                            <Setter Property="Text" Value=" (0)"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Compressed Files Audit Card -->
                                <Border Background="{Binding SelectedFolder.CompressedAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" CornerRadius="3" Padding="8,4" Margin="0,5,10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <fa:IconBlock Icon="Archive" Foreground="{StaticResource BackgroundBrush}" FontSize="14" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Compressed: " Foreground="{StaticResource BackgroundBrush}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding SelectedFolder.CompressedAuditStatus}" Foreground="{StaticResource BackgroundBrush}" FontWeight="Bold" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding SelectedFolder.CompressedFileCount, StringFormat=' ({0} files)'}" Foreground="{StaticResource BackgroundBrush}"   FontWeight="Bold" VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding SelectedFolder.CompressedFileCount}" Value="0">
                                                            <Setter Property="Text" Value=" (0)"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                            
                            <!-- Simple Text Style with Icons -->
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,0">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ShowAuditSummaryAsCards}" Value="False">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style> 
                                
                                <!-- Naming Audit Text -->
                                <StackPanel Orientation="Horizontal" Margin="0,5,20,0">
                                    <fa:IconBlock Icon="FolderOpen" 
                                        Foreground="{Binding SelectedFolder.NamingAuditStatus, Converter={StaticResource AuditStatusToBrushIconConverter}}"
                                        FontSize="14" 
                                        Margin="0,0,5,0"
                                        VerticalAlignment="Center"/>
                                    <TextBlock Text="Folder Name: " FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SelectedFolder.NamingAuditStatus}" 
                                               Foreground="{Binding SelectedFolder.NamingAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" 
                                               FontWeight="Bold" 
                                               VerticalAlignment="Center"/>
                                </StackPanel>

                                <!-- Blacklist Audit Text -->
                                <StackPanel Orientation="Horizontal" Margin="0,5,20,0">
                                    <fa:IconBlock Icon="Ban" 
                                        Foreground="{Binding SelectedFolder.BlacklistAuditStatus, Converter={StaticResource AuditStatusToBrushIconConverter}}"
                                        FontSize="14" 
                                        Margin="0,0,5,0"
                                        VerticalAlignment="Center"/>
                                    <TextBlock Text="Blacklist: " FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SelectedFolder.BlacklistAuditStatus}" 
                                               Foreground="{Binding SelectedFolder.BlacklistAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" 
                                               FontWeight="Bold" 
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SelectedFolder.BlacklistViolationCount, StringFormat=' ({0} violations)'}"
                                               Foreground="{Binding SelectedFolder.BlacklistAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" 
                                               FontWeight="Bold"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SelectedFolder.BlacklistViolationCount}" Value="0">
                                                        <Setter Property="Text" Value=" (0)"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                                
                                <!-- Compressed Files Audit Text -->
                                <StackPanel Orientation="Horizontal" Margin="0,5,20,0">
                                    <fa:IconBlock Icon="Archive" 
                                        Foreground="{Binding SelectedFolder.CompressedAuditStatus, Converter={StaticResource AuditStatusToBrushIconConverter}}"
                                        FontSize="14"
                                        Margin="0,0,5,0"
                                        VerticalAlignment="Center"/>

                                    <TextBlock Text="Compressed: " FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SelectedFolder.CompressedAuditStatus}" 
                                               Foreground="{Binding SelectedFolder.CompressedAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" 
                                               FontWeight="Bold" 
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SelectedFolder.CompressedFileCount, StringFormat=' ({0} files)'}"
                                               Foreground="{Binding SelectedFolder.CompressedAuditStatus, Converter={StaticResource AuditStatusToBrushConverter}}" 
                                               FontWeight="Bold"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SelectedFolder.CompressedFileCount}" Value="0">
                                                        <Setter Property="Text" Value=" (0)"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>

                            </StackPanel>
 
                        </StackPanel>

                        <!-- Naming Audit Reason Text -->
                        <StackPanel Orientation="Horizontal" Margin="0,5,20,0" Grid.Row="2" Grid.Column="0" Visibility="{Binding SelectedFolder, Converter={StaticResource NullToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedFolder.NamingAuditStatus}" Value="Failed">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <fa:IconBlock Icon="ReplyAll" Foreground="{StaticResource DangerBrush}" Margin="0,0,5,0" FontSize="14">
                                    <fa:IconBlock.RenderTransform>
                                        <RotateTransform Angle="180" />
                                    </fa:IconBlock.RenderTransform>
                                    <fa:IconBlock.RenderTransformOrigin>0.5,0.5</fa:IconBlock.RenderTransformOrigin>
                                </fa:IconBlock>
                                <TextBlock FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource DangerBrush}" Text="{Binding SelectedFolder.NamingFailureReason}" />
                            </StackPanel>
                        </StackPanel>

                        <!-- Action Buttons -->                    
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,0" HorizontalAlignment="Right" Height="40" VerticalAlignment="Center">
                            <Button Command="{Binding AuditFolderCommand}" Style="{StaticResource ButtonStyle}">
                                <Button.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="Individual Audit" Description="This audits the selected folder individually." />
                                    </ToolTip>
                                </Button.ToolTip>
                                <StackPanel Orientation="Horizontal">
                                     <fa:IconBlock Icon="Refresh" Foreground="{StaticResource BackgroundBrush}" Margin="0,0,5,0" FontSize="14"/>
                                    <TextBlock Text="Audit" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <Button Command="{Binding TransferFolderCommand}" Style="{StaticResource SuccessButtonStyle}">
                                <Button.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="Individual Transfer" Description="This transfers the selected folder individually." />
                                    </ToolTip>
                                </Button.ToolTip>
                                <StackPanel Orientation="Horizontal">
                                    <fa:IconBlock Icon="Upload" Foreground="{StaticResource BackgroundBrush}" Margin="0,0,5,0" FontSize="14"/>
                                    <TextBlock Text="Transfer" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <Button Command="{Binding TransferFolderWithOverrideCommand}" Style="{StaticResource WarningButtonStyle}" Margin="5,5,0,5">
                                <Button.ToolTip>
                                    <ToolTip Background="Transparent" BorderThickness="0">
                                        <control:AwesomeToolTip Title="Override a Transfer" Description="Force a transfer even if audit failed" />
                                    </ToolTip>
                                </Button.ToolTip>
                                <StackPanel Orientation="Horizontal">
                                    <fa:IconBlock Icon="Warning" Foreground="{StaticResource BackgroundBrush}" Margin="0,0,5,0" FontSize="14"/>
                                    <TextBlock Text="Override" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <!-- TEST AREA -->
                                <!-- <Button Content="Delete All Files" Click="ShowDialogBtn_Click"/> -->
                                <!-- <Button Content="Delete All Files" Click="ShowTaskDialogButton_Click"/> -->
                            <!-- END TEST AREA -->
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Files Grid -->
                <Border Grid.Row="1" Background="White" BorderBrush="{StaticResource LightBrush}" BorderThickness="1">
                    <DataGrid ItemsSource="{Binding FileList}" 
                              RowHeight="28"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserSortColumns="True"
                              GridLinesVisibility="Horizontal"
                              AlternationCount="2">
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
                                <!-- Default: white background -->
                                <Setter Property="Background" Value="White"/>

                                <Style.Triggers>
                                    <!-- Alternating row - only applies if no other conditions are met -->
                                    <Trigger Property="AlternationIndex" Value="1">
                                        <Setter Property="Background" Value="{StaticResource LightBackgroundBrush}"/>
                                    </Trigger>
                                    
                                    <!-- Compressed files override alternating rows -->
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding IsCompressed}" Value="True"/>
                                            <Condition Binding="{Binding IsBlacklisted}" Value="False"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <SolidColorBrush Color="#F1C40F" Opacity="0.25"/>
                                            </Setter.Value>
                                        </Setter>
                                    </MultiDataTrigger>
                                    
                                    <!-- Blacklisted files get highest priority - override everything -->
                                    <DataTrigger Binding="{Binding IsBlacklisted}" Value="True">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <SolidColorBrush Color="#E74C3C" Opacity="0.35"/>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.Columns>
                            <!-- Icon Column -->
                            <DataGridTemplateColumn Header="" Width="35">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <fa:IconBlock Icon="{Binding Converter={StaticResource FileIconConverter}}" FontSize="14" HorizontalAlignment="Center">
                                            <fa:IconBlock.Style>
                                                <Style TargetType="fa:IconBlock">
                                                    <Setter Property="Foreground" Value="#7f8c8d"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsBlacklisted}" Value="True">
                                                            <Setter Property="Foreground" Value="#e74c3c"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsCompressed}" Value="True">
                                                            <Setter Property="Foreground" Value="#f39c12"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </fa:IconBlock.Style>
                                        </fa:IconBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="File Name" Width="5*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding FileName}" VerticalAlignment="Center">
                                            <TextBlock.ToolTip>
                                                <ToolTip Background="Transparent" BorderThickness="0">
                                                    <ToolTip.Style>
                                                        <Style TargetType="ToolTip">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding HasError}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding IsCompressed}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ToolTip.Style>
                                                    <control:FileListToolTip 
                                                        FileName="{Binding FileName}"  
                                                        FullPath="{Binding FullPath}" 
                                                        SizeFormatted="{Binding SizeFormatted}" 
                                                        IsBlacklisted="{Binding IsBlacklisted}" 
                                                        IsCompressed="{Binding IsCompressed}" 
                                                        Extension="{Binding Extension}"
                                                        Recommendations="{Binding RecommendedActions}"
                                                        ErrorMessage="{Binding ErrorMessage}"
                                                        ErrorDetails="{Binding ErrorDetails}"/>
                                                </ToolTip>
                                            </TextBlock.ToolTip>
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="ToolTipService.InitialShowDelay" Value="300"/>
                                                    <Setter Property="ToolTipService.ShowDuration" Value="30000"/>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" Width="*"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeFormatted}" Width="*"/>
                            <DataGridTextColumn Header="Modified" Binding="{Binding Modified}" Width="2*"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*"/>
                            <DataGridTemplateColumn Header="Action" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Command="{Binding DataContext.ViewFileContentsCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                IsEnabled="{Binding IsViewable}"
                                                Margin="5,0"
                                                Padding="5,3"
                                                FontSize="10"
                                                Background="{StaticResource PrimaryBrush}"
                                                Foreground="{StaticResource BackgroundBrush}"
                                                BorderThickness="0"
                                                Cursor="Hand"
                                                ToolTipService.ToolTip="{x:Null}">
                                            <StackPanel Orientation="Horizontal">
                                                <fa:IconBlock Icon="Eye" Foreground="{StaticResource BackgroundBrush}" Margin="0,0,3,0"/>
                                                <TextBlock Text="View" VerticalAlignment="Center" FontSize="10"/>
                                            </StackPanel>
                                        </Button>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
                
                <!-- Progress -->
                <Grid Grid.Row="2">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Retention Cleanup Status Card -->
                    <Border Grid.Column="0" Background="White" BorderBrush="{StaticResource LightBrush}" BorderThickness="1" Padding="15,10" Margin="0,10,10,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="{Binding ProgressText}" FontWeight="SemiBold"/>
                            <ProgressBar Grid.Row="1" Height="20" Value="{Binding ProgressPercent}" Minimum="0" Maximum="100" Margin="0,5,0,0"/>
                        </Grid>
                    </Border>

                    <!-- Transfer Engine Status Card -->
                    <Border Grid.Column="1" Background="White" BorderBrush="{StaticResource LightBrush}" BorderThickness="1" Padding="15,10" Margin="0,10,10,0" MinWidth="260">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Row="0" Grid.ColumnSpan="2" FontSize="12" Margin="0,0,5,5" Text="">
                                <Run Text="Transfer Engine: "/>     
                                <Run Text="{Binding TransferEngine, Mode=OneWay}" FontWeight="SemiBold"/>
                            </TextBlock>

                            <!-- Animated icon when transfer is active -->
                            <fa:IconImage Icon="Sync" 
                                Grid.Row="1" 
                                Grid.Column="0"  
                                Foreground="{StaticResource PrimaryBrush}" 
                                RenderTransformOrigin="0.5,0.5" 
                                Height="16" 
                                Width="16" 
                                VerticalAlignment="Center" 
                                HorizontalAlignment="Center"
                                Margin="0,0" 
                                Opacity="0">
                                <fa:IconImage.RenderTransform>
                                    <RotateTransform Angle="0" />
                                </fa:IconImage.RenderTransform>
                                <fa:IconImage.Style>
                                    <Style TargetType="fa:IconImage">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsTransferActive}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <!-- Fade in -->
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" To="1" Duration="0:0:0.3" />
                                                            <!-- Continuous rotation -->
                                                            <DoubleAnimation Storyboard.TargetProperty="(fa:IconImage.RenderTransform).(RotateTransform.Angle)"
                                                                From="0" To="360" Duration="0:0:1.5" RepeatBehavior="Forever" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                                <DataTrigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <!-- Fade out -->
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.3" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.ExitActions>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </fa:IconImage.Style>
                            </fa:IconImage>
                            
                            <!-- Static icon when idle -->
                            <fa:IconBlock Icon="PowerOff" 
                                Grid.Row="1" 
                                Grid.Column="0" 
                                Foreground="{StaticResource SecondaryBrush}" 
                                FontSize="16" 
                                Margin="0,0" 
                                Opacity="1" 
                                VerticalAlignment="Center" 
                                HorizontalAlignment="Center">
                                <fa:IconBlock.Style>
                                    <Style TargetType="fa:IconBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsTransferActive}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.3" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                                <DataTrigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" To="1" Duration="0:0:0.3" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.ExitActions>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </fa:IconBlock.Style>
                            </fa:IconBlock>
                            
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding ProgressIssues}" FontWeight="SemiBold" FontSize="14" Margin="8,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                        </Grid>
                    </Border>

                    <!-- Retention Cleanup Status Card -->
                    <Border Grid.Column="2" Background="White" BorderBrush="{StaticResource LightBrush}" BorderThickness="1" Padding="15,10" Margin="0,10,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                    
            
                            <fa:IconBlock Grid.Column="0" Grid.Row="1" Icon="Tasks" Foreground="{StaticResource SecondaryBrush}" FontSize="16" Margin="0,0,8,0"/>

                            <TextBlock Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3" FontSize="12" Margin="0,0,5,0" Text="{Binding Settings.RetentionDays, Converter={StaticResource PluralizationConverter}, ConverterParameter=Day|Days}"/>

                            <TextBlock Grid.Column="1" Grid.Row="1"  Text="Retention Cleanup" FontWeight="SemiBold" FontSize="14"/>

                            <Border Grid.Column="2" Grid.Row="1"  Width="0" VerticalAlignment="Center" Margin="0,0,0,0">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsRetentionCleanupRunning}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="Width" To="50" Duration="0:0:0.3" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                                <DataTrigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="Width" To="0" Duration="0:0:0.3" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.ExitActions>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <fa:IconImage Visibility="{Binding IsRetentionCleanupRunning, Converter={StaticResource BooleanToVisibilityConverter}}"
                                            Icon="Refresh" Foreground="Black" RenderTransformOrigin="0.5,0.5" Height="16" Width="16"
                                            VerticalAlignment="Center" Margin="0,0,0,0">
                                        <fa:IconImage.RenderTransform>
                                            <RotateTransform x:Name="noFreezeRotate" Angle="0" />
                                        </fa:IconImage.RenderTransform>
                                        <fa:IconImage.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="(fa:IconImage.RenderTransform).(RotateTransform.Angle)"
                                                            From="0" To="360" Duration="0:0:1" RepeatBehavior="Forever" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </fa:IconImage.Triggers>
                                    </fa:IconImage>
                                    <fa:IconBlock Visibility="{Binding IsRetentionCleanupRunning, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                        VerticalAlignment="Center">
                                        <fa:IconBlock.Style>
                                            <Style TargetType="fa:IconBlock">
                                                <Setter Property="Icon" Value="CheckCircle"/>
                                                <Setter Property="Foreground" Value="Green"/>
                                                <Setter Property="FontSize" Value="16"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RetentionStatus}" Value="Error">
                                                        <Setter Property="Icon" Value="TimesCircle"/>
                                                        <Setter Property="Foreground" Value="Red"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </fa:IconBlock.Style>
                                    </fa:IconBlock>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
        
         <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource DarkBrush}" Padding="10,5">
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding StatusMessage}" Foreground="{StaticResource BackgroundBrush}" VerticalAlignment="Center" Grid.Column="0" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding AppFooter}" Foreground="{StaticResource BackgroundBrush}" VerticalAlignment="Center" Grid.Column="2" FontWeight="SemiBold"/>
            </Grid>
        </Border>

        <!-- Snackbar Notification Overlay - Avalonia-style slide from top-right -->
        <!-- To adjust brightness: Change SnackbarOpacity in MainViewModel.cs (current: 0.90) -->
        <!-- Background colors also include alpha channel (E6 = ~90%) for additional control -->
        <Border Grid.RowSpan="4"
                Panel.ZIndex="999"
                HorizontalAlignment="Right" 
                VerticalAlignment="Top" 
                Margin="0,60,20,0"
                Background="{Binding SnackbarBackground}"
                CornerRadius="4"
                Padding="16,12"
                MinWidth="280"
                MaxWidth="400"
                IsHitTestVisible="False"
                RenderTransformOrigin="1,0">
            <Border.RenderTransform>
                <TranslateTransform X="400"/>
            </Border.RenderTransform>
            <Border.Effect>
                <DropShadowEffect BlurRadius="12" ShadowDepth="3" Opacity="0.4" Color="Black"/>
            </Border.Effect>
            <Border.Style>
                <Style TargetType="Border">
                    <!-- Default: Hidden -->
                    <Setter Property="Opacity" Value="0"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSnackbarVisible}" Value="True">
                            <!-- Set opacity to bound value when visible -->
                            <Setter Property="Opacity" Value="{Binding SnackbarOpacity}"/>
                            <DataTrigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <!-- Slide in from right -->
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.X)" From="400" To="0" Duration="0:0:0.4">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseOut"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <!-- Smooth fade in to bound opacity value -->
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" Duration="0:0:0.35" FillBehavior="Stop"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>
                            <DataTrigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <!-- Slide out to right -->
                                        <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(TranslateTransform.X)" From="0" To="400" Duration="0:0:0.3">
                                            <DoubleAnimation.EasingFunction>
                                                <CubicEase EasingMode="EaseIn"/>
                                            </DoubleAnimation.EasingFunction>
                                        </DoubleAnimation>
                                        <!-- Fade out -->
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.25"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <StackPanel>
                <TextBlock Text="{Binding SnackbarMessage}" 
                           Foreground="{StaticResource BackgroundBrush}" 
                           FontSize="13" 
                           FontWeight="SemiBold"
                           TextWrapping="Wrap"
                           TextAlignment="Left"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
